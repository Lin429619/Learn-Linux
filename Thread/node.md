## 同步
##### 同步工具
* 信号量：一个信号量是一个由内核维护的整数,**其值永远不会小于 0**。一个进程可以增加或减小一个信号量的值。如果一个进程试图将信号量的值减小到小于 0,那么内核会阻塞该操作直至信号量的值增长到允许执行该操作的程度。（或者进程可以要求执行一个非阻塞操作,那么就不会发生阻塞,内核会让该操作立即返回并返回一个标示无法立即执行该操作的错误。）
> 信号量表示资源的数量，控制信号量的方式有两种原子操作：
> * 一个是 ==P 操作==，这个操作会把信号量==减去 1==，相减后如果信号量 < 0，则表明资源已被占用，进程需阻塞等待；相减后如果信号量 >= 0，则表明还有资源可使用，进程可正常继续执行。
> * 另一个是== V 操作==，这个操作会把信号量==加上 1==，相加后如果信号量 <= 0，则表明当前有阻塞中的进程，于是会将该进程唤醒运行；相加后如果信号量 > 0，则表明当前没有阻塞中的进程；
> * P 操作是用在进入共享资源之前，V 操作是用在离开共享资源之后，这两个操作是必须==成对==出现的。
* 文件锁：可协调操作同一文件的多个进程的动作以及对其他共享资源的访问。分为读(共享)锁和写(互斥)锁。任意进程都可以持有同一文件(或一个文件的某段区域)的读锁,但当一个进程持有了一个文件(或文件区域)的**写锁**之后,**其他进程将无法获取该文件(或文件区域)上的读锁和写锁。**
> fcntl()系统调用提供了记录加锁,允许进程在同一文件的不同区域上加上多个读锁和写锁。
* 互斥体和条件变量

**小总结：** 当协调对==文件==的访问时==文件记录加锁==通常是最佳的选择,而对于协调对==其他共享资源==的访问来讲,==信号量==通常是更佳的选择。

